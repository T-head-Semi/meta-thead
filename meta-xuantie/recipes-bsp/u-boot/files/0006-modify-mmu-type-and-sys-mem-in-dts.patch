From d42a88e12a7bd12e4c9550c5a372924cc05f545a Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E6=81=92=E7=95=85?= <dongkaiyuan.dky@alibaba-inc.com>
Date: Tue, 19 Nov 2024 09:36:44 +0000
Subject: [PATCH] modify cpu

---
 arch/riscv/dts/fpga-xuantie-riscv32.dts | 151 ++----------------------
 arch/riscv/dts/fpga-xuantie-riscv64.dts | 133 ---------------------
 2 files changed, 9 insertions(+), 275 deletions(-)

diff --git a/arch/riscv/dts/fpga-xuantie-riscv32.dts b/arch/riscv/dts/fpga-xuantie-riscv32.dts
index ff9c714614..8548b446f2 100755
--- a/arch/riscv/dts/fpga-xuantie-riscv32.dts
+++ b/arch/riscv/dts/fpga-xuantie-riscv32.dts
@@ -7,7 +7,7 @@
 
 	memory@60000000 {
 		device_type = "memory";
-		reg = <0x0 0x60000000 0x1 0x00000000>;
+		reg = <0x0 0x60000000 0x0 0x40000000>;
 	};
 
 	cpus {
@@ -20,7 +20,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu0_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -34,7 +34,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu1_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -48,7 +48,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu2_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -62,7 +62,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu3_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -76,7 +76,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu4_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -90,7 +90,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu5_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -104,7 +104,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu6_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -118,7 +118,7 @@
 			status = "okay";
 			compatible = "riscv";
 			riscv,isa = "rv32i";
-			mmu-type = "riscv,sv39";
+			mmu-type = "riscv,sv32";
 			riscv,cbom-block-size = <64>;
 			cpu7_intc: interrupt-controller {
 				#interrupt-cells = <1>;
@@ -128,139 +128,6 @@
 		};
 	};
 
-	pmu {
-		compatible = "riscv,pmu";
-		riscv,event-to-mhpmevent =
-			/* event-id event-selector */
-			/* event: PMU_HW_CACHE_REFERENCES */
-			/* ll_cache_read_access */
-			<0x00003 0x00000000 0x00000010>,
-			/* event: PMU_HW_CACHE_MISSES */
-			/* ll_cache_read_miss */
-			<0x00004 0x00000000 0x00000011>,
-			/* event: PMU_HW_BRANCH_INSTRUCTIONS */
-			/* inst_branch */
-			<0x00005 0x00000000 0x00000007>,
-			/* event: PMU_HW_BRANCH_MISSES */
-			/* inst_branch_mispredict */
-			<0x00006 0x00000000 0x00000006>,
-			/* event: PMU_HW_STALLED_CYCLES_FRONTEND */
-			/* ifu_stalled_cycle */
-			<0x00008 0x00000000 0x00000027>,
-			/* event: PMU_HW_STALLED_CYCLES_BACKEND */
-			/* idu_stalled_cycle */
-			<0x00009 0x00000000 0x00000028>,
-			/* event: L1D_READ_ACCESS */
-			/* l1_dcache_read_access */
-			<0x10000 0x00000000 0x0000000c>,
-			/* event: L1D_READ_MISS */
-			/* l1_dcache_read_miss */
-			<0x10001 0x00000000 0x0000000d>,
-			/* event: L1D_WRITE_ACCESS */
-			/* l1_dcache_write_access */
-			<0x10002 0x00000000 0x0000000e>,
-			/* event: L1D_WRITE_MISS */
-			/* l1_dcache_write_miss */
-			<0x10003 0x00000000 0x0000000f>,
-			/* event: L1I_READ_ACCESS */
-			/* l1_icache_access */
-			<0x10008 0x00000000 0x00000001>,
-			/* event: L1I_READ_MISS */
-			/* l1_icache_miss */
-			<0x10009 0x00000000 0x00000002>,
-			/* event: LL_READ_ACCESS */
-			/* ll_cache_read_access */
-			<0x10010 0x00000000 0x00000010>,
-			/* event: LL_READ_MISS */
-			/* ll_cache_read_miss */
-			<0x10011 0x00000000 0x00000011>,
-			/* event: LL_WRITE_ACCESS */
-			/* ll_cache_write_access */
-			<0x10012 0x00000000 0x00000012>,
-			/* event: LL_WRITE_MISS */
-			/* ll_cache_write_miss */
-			<0x10013 0x00000000 0x00000013>,
-			/* event: DTLB_READ_MISS */
-			/* dtlb_miss */
-			<0x10019 0x00000000 0x00000004>,
-			/* event: ITLB_READ_MISS */
-			/* itlb_miss */
-			<0x10021 0x00000000 0x00000003>,
-			/* event: BPU_READ_ACCESS */
-			/* branch_direction_prediction */
-			<0x10030 0x00000000 0x0000001c>,
-			/* event: BPU_READ_MISS */
-			/* branch_direction_misprediction */
-			<0x10031 0x00000000 0x0000001b>;
-		riscv,event-to-mhpmcounters =
-			/* event-start event-end a bitmap of all the MHPMCOUNTERx */
-			<0x00003 0x00003 0xfffffff8>,
-			<0x00004 0x00004 0xfffffff8>,
-			<0x00005 0x00005 0xfffffff8>,
-			<0x00006 0x00006 0xfffffff8>,
-			<0x00007 0x00007 0xfffffff8>,
-			<0x00008 0x00008 0xfffffff8>,
-			<0x00009 0x00009 0xfffffff8>,
-			<0x0000a 0x0000a 0xfffffff8>,
-			<0x10000 0x10000 0xfffffff8>,
-			<0x10001 0x10001 0xfffffff8>,
-			<0x10002 0x10002 0xfffffff8>,
-			<0x10003 0x10003 0xfffffff8>,
-			<0x10008 0x10008 0xfffffff8>,
-			<0x10009 0x10009 0xfffffff8>,
-			<0x10010 0x10010 0xfffffff8>,
-			<0x10011 0x10011 0xfffffff8>,
-			<0x10012 0x10012 0xfffffff8>,
-			<0x10013 0x10013 0xfffffff8>,
-			<0x10019 0x10019 0xfffffff8>,
-			<0x10021 0x10021 0xfffffff8>,
-			<0x10030 0x10030 0xfffffff8>,
-			<0x10031 0x10031 0xfffffff8>;
-		riscv,raw-event-to-mhpmcounters =
-			<0x00000000 0x00000001 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000002 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000003 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000004 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000005 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000006 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000007 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000008 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000009 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000a 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000b 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000c 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000d 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000e 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000f 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000010 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000011 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000012 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000013 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000014 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000015 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000016 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000017 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000018 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000019 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001a 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001b 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001c 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001d 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001e 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001f 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000020 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000021 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000022 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000023 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000024 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000025 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000026 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000027 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000028 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000029 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000002a 0xffffffff 0xffffffff 0xfffffff8>;
-	};
-
 	soc {
 		#address-cells = <2>;
 		#size-cells = <2>;
diff --git a/arch/riscv/dts/fpga-xuantie-riscv64.dts b/arch/riscv/dts/fpga-xuantie-riscv64.dts
index 6ed7ff9664..b1136e73ba 100755
--- a/arch/riscv/dts/fpga-xuantie-riscv64.dts
+++ b/arch/riscv/dts/fpga-xuantie-riscv64.dts
@@ -128,139 +128,6 @@
 		};
 	};
 
-	pmu {
-		compatible = "riscv,pmu";
-		riscv,event-to-mhpmevent =
-			/* event-id event-selector */
-			/* event: PMU_HW_CACHE_REFERENCES */
-			/* ll_cache_read_access */
-			<0x00003 0x00000000 0x00000010>,
-			/* event: PMU_HW_CACHE_MISSES */
-			/* ll_cache_read_miss */
-			<0x00004 0x00000000 0x00000011>,
-			/* event: PMU_HW_BRANCH_INSTRUCTIONS */
-			/* inst_branch */
-			<0x00005 0x00000000 0x00000007>,
-			/* event: PMU_HW_BRANCH_MISSES */
-			/* inst_branch_mispredict */
-			<0x00006 0x00000000 0x00000006>,
-			/* event: PMU_HW_STALLED_CYCLES_FRONTEND */
-			/* ifu_stalled_cycle */
-			<0x00008 0x00000000 0x00000027>,
-			/* event: PMU_HW_STALLED_CYCLES_BACKEND */
-			/* idu_stalled_cycle */
-			<0x00009 0x00000000 0x00000028>,
-			/* event: L1D_READ_ACCESS */
-			/* l1_dcache_read_access */
-			<0x10000 0x00000000 0x0000000c>,
-			/* event: L1D_READ_MISS */
-			/* l1_dcache_read_miss */
-			<0x10001 0x00000000 0x0000000d>,
-			/* event: L1D_WRITE_ACCESS */
-			/* l1_dcache_write_access */
-			<0x10002 0x00000000 0x0000000e>,
-			/* event: L1D_WRITE_MISS */
-			/* l1_dcache_write_miss */
-			<0x10003 0x00000000 0x0000000f>,
-			/* event: L1I_READ_ACCESS */
-			/* l1_icache_access */
-			<0x10008 0x00000000 0x00000001>,
-			/* event: L1I_READ_MISS */
-			/* l1_icache_miss */
-			<0x10009 0x00000000 0x00000002>,
-			/* event: LL_READ_ACCESS */
-			/* ll_cache_read_access */
-			<0x10010 0x00000000 0x00000010>,
-			/* event: LL_READ_MISS */
-			/* ll_cache_read_miss */
-			<0x10011 0x00000000 0x00000011>,
-			/* event: LL_WRITE_ACCESS */
-			/* ll_cache_write_access */
-			<0x10012 0x00000000 0x00000012>,
-			/* event: LL_WRITE_MISS */
-			/* ll_cache_write_miss */
-			<0x10013 0x00000000 0x00000013>,
-			/* event: DTLB_READ_MISS */
-			/* dtlb_miss */
-			<0x10019 0x00000000 0x00000004>,
-			/* event: ITLB_READ_MISS */
-			/* itlb_miss */
-			<0x10021 0x00000000 0x00000003>,
-			/* event: BPU_READ_ACCESS */
-			/* branch_direction_prediction */
-			<0x10030 0x00000000 0x0000001c>,
-			/* event: BPU_READ_MISS */
-			/* branch_direction_misprediction */
-			<0x10031 0x00000000 0x0000001b>;
-		riscv,event-to-mhpmcounters =
-			/* event-start event-end a bitmap of all the MHPMCOUNTERx */
-			<0x00003 0x00003 0xfffffff8>,
-			<0x00004 0x00004 0xfffffff8>,
-			<0x00005 0x00005 0xfffffff8>,
-			<0x00006 0x00006 0xfffffff8>,
-			<0x00007 0x00007 0xfffffff8>,
-			<0x00008 0x00008 0xfffffff8>,
-			<0x00009 0x00009 0xfffffff8>,
-			<0x0000a 0x0000a 0xfffffff8>,
-			<0x10000 0x10000 0xfffffff8>,
-			<0x10001 0x10001 0xfffffff8>,
-			<0x10002 0x10002 0xfffffff8>,
-			<0x10003 0x10003 0xfffffff8>,
-			<0x10008 0x10008 0xfffffff8>,
-			<0x10009 0x10009 0xfffffff8>,
-			<0x10010 0x10010 0xfffffff8>,
-			<0x10011 0x10011 0xfffffff8>,
-			<0x10012 0x10012 0xfffffff8>,
-			<0x10013 0x10013 0xfffffff8>,
-			<0x10019 0x10019 0xfffffff8>,
-			<0x10021 0x10021 0xfffffff8>,
-			<0x10030 0x10030 0xfffffff8>,
-			<0x10031 0x10031 0xfffffff8>;
-		riscv,raw-event-to-mhpmcounters =
-			<0x00000000 0x00000001 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000002 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000003 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000004 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000005 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000006 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000007 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000008 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000009 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000a 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000b 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000c 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000d 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000e 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000000f 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000010 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000011 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000012 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000013 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000014 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000015 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000016 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000017 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000018 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000019 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001a 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001b 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001c 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001d 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001e 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000001f 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000020 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000021 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000022 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000023 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000024 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000025 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000026 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000027 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000028 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x00000029 0xffffffff 0xffffffff 0xfffffff8>,
-			<0x00000000 0x0000002a 0xffffffff 0xffffffff 0xfffffff8>;
-	};
-
 	soc {
 		#address-cells = <2>;
 		#size-cells = <2>;
-- 
2.47.0

